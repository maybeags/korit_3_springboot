# 입실 체크 해주세요 !! 🏎

# SpringBoot RESTful API
## REST 기초
### 정의
- REST - Representational State Transfer의 축약어로 웹 서비스를 제작하기 위한
아키텍처 스타일. 특정 언어나 플랫폼에 의존적이지 않으며 모바일 앱 기타 서비스와
같은 다양한 클라이언트들이 서로 통신할 수 있도록 하는데 이점이 있음.

- 구체적인 표준이 아니라 로이 필딩이라는 사람이 제시한 제약 조건에 가까움.
### 제약 조건
1. 상태 비저장
   - 서버는 클라이언트 상태에 관한 어떤 정보도 저장하지 않아야 한다.
2. 클라이언트-서버 간의 독립성
    - 클라이언트와 서버는 독립적으로 작동해야 한다. 서버는 클라이언트의 요청없이
        어떠한 정보도 전송해서는 안된다.
3. 캐시 가능
   - 여러 클라이언트가 동일한 리소스를 요청하는 경우가 많으므로 성능 향상을 위해
    리소스에 캐싱을 적용해야 한다.
4. 일관된 인터페이스
    - 서로 다른 클라이언트에 의한 요청이더라도 응답은 동일하게 보여야 한다.
    클라이언트의 예로는 브라우저, Java 애플리케이션, 모바일 애플리케이션 등
5. 계층형 시스템
    - 전체 서비스에 영향을 주지 않고 구성 요소를 추가하거나 수정할 수 있어야한다.
    이 제약 조건은 확장성과 관련이 있다.
6. 주문형 코드
    - 선택적 제약 조건으로, 대부분 서버는 정적 컨텐츠를 JSON 또는 XML
      (extended markup language) 형식으로 전송한다. 이 제약 조건은 필요한
    경우 서버가 정적 컨텐츠만이 아니라 실행 코드를 전송할 수 있어야 한다.

이상에서 일관된 인터페이스는 중요한 제약 조건이며 REST 아키텍처에 다음 요소가
포함될 필요가 있다.

- 리소스 식별
  - 리소스는고유 식별자(예- 웹 기반 REST 서비스의 URL)로 식별해야 함.
  - REST 리소스는 이해하기 쉬운 디렉토리 구조의 URL을 노출해야 함.
  - 이상을 이유로 리소스 명명 전략이 매우 중요.
- 표현을 통한 리소스 조작
  - 리소스를 요청(Request)할 때 서버는 리소스의 표현으로 응답(Response)해야함.
  - 일반적인 표현 형식으로는 JSON / XML
- 자체 설명적인 메시지
  - 메시지는 서버가 처리 방법을 알 수 있는 충분한 정보가 포함되어야 함.
- HATEOAS(HyperMedia As the Engine of Application State).
  - 응답에는 서비스의 다른 영역으로 연결되는 링크가 포함되어야 함.

다 작성하신 분들은 cardatabase2에 domain과 같은 위치에 web 패키지 생성
web 하위에 CarController 클래스 생성

## 스프링 부트로 RESTful 웹 서비스 만들기
1. cardatabase2에 domain과 같은 위치에 web 패키지 생성
2. web 하위에 CarController 클래스 생성
3. CarController 내부에
```java
package com.packt.cardatabase.web;

import org.springframework.web.bind.annotation.RestController;

@RestController
public class CarController {
}
```
4. @RestController 애너테이션은 해당 클래스가 RESTful 웹 서비스가 되도록 지정
5. CarController 클래스에 새로운 메서드를 추가합니다.
    메서드가 매핑되는 엔드포인트를 정의하는 @RequestMapping 애너테이션을 저장
    이하의 메서드는 '사용자가 /cars 엔드포인트로 GET 요청을 하면 getCars()
    메서드가 실행'된다.
    
    getCars() 메서드는 모든 자동차 객체를 반환한 다음에 Jackson 라이브러리에
    의해 자동으로 JSON 객체로 마샬링됩니다.
    * 마샬링 - 객체를 일련의 바이트로 변환하는 과정으로, 객체를 저장하거나 전송
        이 가능. 여기서는 Java 객체를 JSON 형식의 문자열로 변환하는 것이 해당 
   
    @GetMapping을 통해 /cars 엔드포인트의 GET 요청만 처리함.    
    다양한 HTTP 메서드(POST / GET / UPDATE / DELETE)에 대한
    애너테이션(@GetMapping / @PostMapping / @DeleteMapping 등)이 존재.

6. 데이터베이스에서 자동차를 반환할 수 있게 하려면 Controller에 CarRepository를
    주입해야 한다. 그런 다음 CrudRepository에서 제공하는 findAll() 메서드로
    모든 자동차를 검색할 수 있다.
    그러면 @RestController 애너테이션 덕분에 데이터가 응답에서 알아서
    JSON 형식의 문자열로 직렬화된다.

```java
package com.packt.cardatabase.web;

import com.packt.cardatabase.domain.Car;
import com.packt.cardatabase.domain.CarRepository;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class CarController {
    private final CarRepository repository;

    public CarController(CarRepository repository) {
        this.repository = repository;
    }

    @GetMapping("/cars")
    public Iterable<Car> getCars() {
        // 자동차를 검색하고나서 반환
        return repository.findAll();
    }

}
```

7. 이상의 코드를 작성하고 애플리케이션을 실행시킨 후에 엔드포인트인
    http://localhost:8080/cars 로 이동해보면, 무한루프 형태로 JSON 데이터가
    출력됨을 확인할 수 있다.

    이는 car 테이블과 owner 테이블 간의 일대다 관계 때문으로, 풀어서 설명하면
    먼저 자동차가 직렬화되면 연결된 소유자가 직렬화되고, 이어서 그 소유자가
    가진 자동차가 다시 직렬화되는 방식으로 첫 번째 car 데이터를 불러오면서
    무한 루프에 빠지는 것이다.

    이상을 해결하기 위한 방안 중 하나로는 Owner 클래스의 자동차 필드에
    @JsonIgnore 애너테이션을 이용하여 직렬화 프로세스 중에 자동차 필드를
    무시하도록 지정하는 것이다. 

    필요하지 않은 경우 양방향 매핑을 이용하지 않으므로써 문제를 해결할 수도 있는데
    @JsonIgnoreProperties 애너테이션을 함께 이용하여 하이버네이트가 생성된 필드를
    무시하는 방법도 있다.

    다하신 분은 Owner.java로 이동합니다.
    
## 스프링 데이터 REST 이용하기

스프링 데이터 REST는 스프링 데이터 프로젝트의 일부이며, 스프링으로 RESTful 웹 서비스를
쉽고 빠르게 구현할 수 있도록 해줍니다. 스프링 데이터 REST는 클라이언트가 하이퍼미디어
링크를 이용하여 REST API를 동적으로 탐색할 수 있도록 하는 아키텍처 원칙인
HATEOAS를 지원합니다. REST API 엔드포인트의 비지니스 로직을 사용자 정의하는 데
이용할 수 있는 이벤트를 제공.

스프링 데이터 REST를 사용하기 위해서는 build.grade 파일에 의존성 추가해야합니다.
chrome -> mvn 검색 -> maven repository에서 spring data rest 검색
-> 최신 버전 -> groovy short 선택
```properties
implementation 'org.springframework.boot:spring-boot-starter-data-rest:3.4.5'
```
스프링 데이터 REST는 기본적으로 애플리케이션에서 공용 리포지토리를 찾고 엔티티를 위한 RESTful
웹 서비스를 자동으로 생성합니다. 현재 저희는 CarRepository와 OwnerRepository가 있으며
스프링 데이터 REST는 각각 리포지토리에 대한 RESTful 웹 서비스를 생성합니다.

그리고 application.properties 파일에서 서비스의 엔드포인트를 정의하는 것이 가능합니다.
* 변경사항 적용하려면 껐다 켜야할 수 있습니다.
```properties
spring.data.rest.basePath=/api
```
이를 적용하고 나면 localhost:8080/api 엔드포인트에서 RESTful 웹 서비스에 접근 가능합니다.
서비스의 루트(root) 엔드포인트를 호출하면 이용 가능한 리소스 전체를 반환합니다.
스프링 데이터 REST는 JSON 데이터를 HAL(Hypertext Application Language) 형식으로 반환합니다.
HAL 형식은 하이퍼링크를 JSON으로 표현하는 규칙을 정의해서 frontend 개발자가 RESTful 웹 서비스를
더 쉽게 이용 가능하도록 해줍니다.

이상의 작업을 완료하게 되면 자동차 / 소유자 엔티티 서비스에 대한 링크가 생성됐음을 확인할 수 있습니다.
스프링 데이터 REST 서비스 경로 이름은 엔티티 이름에서 파생되어 복수형으로 바뀐 후 소문자로 변경됩니다.
예를 들어 Car 엔티티의 서비스 경로 이름은 cars가 됩니다. /api에서 확인 가능합니다.

근데 맨 밑에 profile이 있는데, 이는 스프링 데이터 REST가 생성한 것으로, 애플리케이션 별 메타데이터를
포함합니다. 그리고 경로 이름을 바꾸는 것도 가능합니다.
경로 이름 바꾸는 예시
```java
package com.packt.cardatabase.domain;

import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;

import java.util.List;

@RepositoryRestResource(path="vehicles")
public interface CarRepository extends CrudRepository<Car, Long> {
}
```
@RepositoryRestResource(path="vehicles")를 클래스 레벨에 작성했습니다.
이상과 같이 작성했을 경우
http://localhost:8080/api/cars 는 사용이 불가능해지고,
http://localhost:8080/api/vehicles 를 통해서 car 관련 데이터에 접근 가능합니다.

이제 또 다른 서비스들을 확인할건데, RESTful 웹 서비를 테스트하고 활용할 수 있는 툴들이 있습니다.

저희는 postman을 사용할 예정이지만 cURL 등도 사용할 수 있습니다.

http://localhost:8080/api/cars 로 들어갔을 때,
즉 /cars 엔드포인트를 GET 메서드로 요청했다는 의미로(GET 요청은 웹 브라우저를 이용할 수 있기
때문에), 아까 전과 같은 모든 자동차 목록이 반환됩니다.

JSON 응답을 확인했을 때 자동차의 배열이 있고, 각 cars의 element로 자동차 별 데이터가
포함된 것을 확인할 수 있습니다.
```json
{
  "_embedded" : {
    "cars" : [ {
      "brand" : "Ford",
      "model" : "Mustang",
      "color" : "Red",
      "registrationNumber" : "ADF-11121",
      "modelYear" : 2023,
      "price" : 59000,
      "_links" : {
        "self" : {
          "href" : "http://localhost:8080/api/cars/1"
        },
        "car" : {
          "href" : "http://localhost:8080/api/cars/1"
        },
        "owner" : {
          "href" : "http://localhost:8080/api/cars/1/owner"
        }
      }
    }, {
      "brand" : "Nissan",
      "model" : "Leaf",
      "color" : "White",
      "registrationNumber" : "SSJ-3002",
      "modelYear" : 2020,
      "price" : 29000,
      "_links" : {
        "self" : {
          "href" : "http://localhost:8080/api/cars/2"
        },
        "car" : {
          "href" : "http://localhost:8080/api/cars/2"
        },
        "owner" : {
          "href" : "http://localhost:8080/api/cars/2/owner"
        }
      }
    }, {
      "brand" : "Toyota",
      "model" : "Prius",
      "color" : "Silver",
      "registrationNumber" : "KKO-0212",
      "modelYear" : 2022,
      "price" : 39000,
      "_links" : {
        "self" : {
          "href" : "http://localhost:8080/api/cars/3"
        },
        "car" : {
          "href" : "http://localhost:8080/api/cars/3"
        },
        "owner" : {
          "href" : "http://localhost:8080/api/cars/3/owner"
        }
      }
    }, {
      "brand" : "Kia",
      "model" : "Seltos",
      "color" : "Chacoal",
      "registrationNumber" : "360수5690",
      "modelYear" : 2020,
      "price" : 28000,
      "_links" : {
        "self" : {
          "href" : "http://localhost:8080/api/cars/4"
        },
        "car" : {
          "href" : "http://localhost:8080/api/cars/4"
        },
        "owner" : {
          "href" : "http://localhost:8080/api/cars/4/owner"
        }
      }
    } ]
  },
  "_links" : {
    "self" : {
      "href" : "http://localhost:8080/api/cars"
    },
    "profile" : {
      "href" : "http://localhost:8080/api/profile/cars"
    }
  }
}
```
_link 속성도 확인할 수 있는데 해당 링크로 car 자체에 접근하거나 owner 소유자를
반환받을 수도 있습니다.

그렇다면 특정 자동차, 예를 들어 3번지의 자동차(셀토스)로 접근하기 위한 방법은
http://localhost:8080/api/cars/{id}

그러면 셀토스 아이디는 뭘까요.
http://localhost:8080/api/cars/4
3이 아니라 4라는 점에 주목하셔야합니다.

markdown 테이블 생성 사이트
https://www.tablesgenerator.com/markdown_tables

| HTTP 메서드  | CRUD         |
|-----------|--------------|
| GET       | 읽기(Read)     |
| POST      | 쓰기(Create)   |
| PUT/PATCH | 업데이트(Update) |
| DELETE    | 삭제(Delete)   |

스프링 데이터 REST 서비스는 모든 CRUD 작업을 제공합니다.
그래서 이제 저희는 RESTful 웹 서비스를 활용하여 데이터베이스에서 자동차를 삭제하는
방법을 수업할겁니다.
자동차를 삭제하기 위해서는 DELETE 메서드를 통해 삭제될 자동차의 링크를 지정해야합니다.

잘 생각해보면 저희가 차 데이터를 지운다고 가정했을 때 가장 편하게 떠올릴 수 있는 방법은
1. CarDatabaseApplication에서 만들어놨던 예제 데이터를 삭제하는 방법
2. HeidiSQL에서 delete sql문을 작성하는 방법
근데 새로운 방법 배울겁니다.

chrome에서 postman -> sign up하고 -> desktop installer 다운





