# ì…ì‹¤ ì²´í¬ í•´ì£¼ì„¸ìš” !! ğŸ›º

# Review

1. Spring Initializrë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ cardatabase1ê³¼ ë™ì¼í•œ ì˜ì¡´ì„±ì„
    ì§€ë‹ˆê³  ìˆëŠ” cardatabase2ë¥¼ ìƒì„±
    - cardatabase2ë¥¼ group id / artifactë¡œ ì„¤ì •í•˜ëŠ” ë°”ëŒì—
    ê·¸ëŒ€ë¡œ ë³µì‚¬í–ˆì„ ë•Œ íŒ¨í‚¤ì§€ ì´ë¦„ì´ ë‚˜ì˜¤ë©´ì„œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.
    - ì´ìƒì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ cardatabase3 ë§Œë“¤ ë•ŒëŠ” ëŒ€ë†“ê³ 
    cardatabase1ì„ ë³µì‚¬í•´ì„œ ì„¤ì •í•´ë´¤ì—ˆìŠµë‹ˆë‹¤.
2. RESTful ì›¹ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„
    - RESTì˜ ì˜ë¯¸ / ì œì•½ ì¡°ê±´
    - web/CarController
      - @GetMapping("/cars")
```java
public class CarController {
    private final CarRepository repository;
    
    public CarController(CarRepository repository) {
        this.repository = repository;
    }
    
    @GetMapping("/cars")
    public Iterable<Car> getCars() {
        repository.findAll();
    }
}
```
ì´ìƒì˜ ì½”ë“œë¥¼ ì‘ì„±í•˜ê²Œ ë˜ë©´
http://localhost:8080/cars
ê·¼ë° ì›ë˜ëŒ€ë¡œë¼ë©´ íŠ¹ì • ì°¨ë¥¼ ì°¾ì•„ë‚´ë ¤ê³ í•˜ë©´ ì¶”ê°€ì ì¸ ë©”ì„œë“œ(ì˜ˆë¥¼ ë“¤ë©´ getCar()ë¥¼ ì •ì˜í•´ì•¼í•©ë‹ˆë‹¤)
```java
public Car getCar() {
    repository.findById(Long id);
}

```
ì˜ˆë¥¼ ë“¤ë©´ ì´ìƒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œìš”.

ê·¸ëŸ°ë° Spring Data RESTë¥¼ ì´ìš©í•˜ê²Œ ë˜ë©´ Controller í´ë˜ìŠ¤ì— ì¼ì¼ì´ í•„ìš”í•œ ë©”ì„œë“œë“¤ì„
ì‘ì„±í•  í•„ìš” ì—†ì´ ì•Œì•„ì„œ ê¸°ë³¸ì ì¸ ë©”ì„œë“œë“¤ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
ê·¸ë¦¬ê³  ë§í¬ í˜•íƒœë¡œ ì œê³µì„ í•˜ê¸° ë•Œë¬¸ì—
JSON íŒŒì¼ì„ ë¶„ì„í•˜ê³  URLì„ í™•ì¸í•¨ìœ¼ë¡œì¨ ê²°ê³¼ê°’ì„ ë¹„êµí•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
ì´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” URL ì£¼ì†Œê°€ ì¢€ ë‹¬ë¼ì¡Œì—ˆìŠµë‹ˆë‹¤.
http://localhost:8080/cars ì˜€ì—ˆëŠ”ë°
http://localhost:8080/api/cars
ê·¸ë ‡ë‹¤ë©´ ë‘ ë²ˆì§¸ ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ê²Œ ëì„ ë•Œ íŠ¹ì • ìë™ì°¨ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ”
http://localhost:8080/api/cars/{id}
ì™€ ê°™ì€ URLì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì°¨ì´ì  ìˆë‹¤ë©´ ìš°ë¦¬ëŠ” ë”ì´ìƒ getCars()ì˜ ìë£Œí˜•ì´ ë­”ì§€ ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ
repositoryì—ì„œ ì–´ë–¤ ë©”ì„œë“œë¥¼ ê°€ì ¸ì™€ì•¼í•˜ëŠ”ì§€ì— ëŒ€í•œ ê³ ë¯¼ì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

3. OpenAPI ë„ì…
- RESTful APIì˜ ëª…ì„¸ì„œë¥¼ ì‘ì„±í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì´ì „ì—ëŠ” Controller í´ë˜ìŠ¤ë“¤ì„ ëŒì•„ë‹¤ë‹ˆë©´ì„œ
ì–´ë–¤ ë©”ì„œë“œë“¤ì´ CRUD ì¤‘ ì–´ë–¤ ê²ƒì— í•´ë‹¹í•˜ëŠ”ì§€, ì–´ë–¤ ë§¤ê°œë³€ìˆ˜ë¥¼ ìš”êµ¬í•˜ê³  ë°˜í™˜ í˜•ì‹ì€ ë¬´ì—‡ì¸ì§€
í•˜ë‚˜ í•˜ë‚˜ ì°¾ì•„ë³´ë©´ì„œ ì‘ì„±í•´ì•¼í–ˆì§€ë§Œ ì´ìƒì˜ OpenAPIëŠ” ìë™ìœ¼ë¡œ ëª…ì„¸ì„œë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤.
ì´ë¥¼ í¬ë¡¬ ìƒì—ì„œ ì¸ì‡„ë¥¼ í•˜ì—¬ PDFë¡œ ë°”ê¾¼ë‹¤ë“ ì§€, ì´ë¥¼ ì´ìš©í•˜ì—¬ notion ë“±ì˜ í¸ì§‘íˆ´ì„ ì´ìš©í•˜ì—¬
ì¡°ì§ì— ë§ëŠ” ì–‘ì‹ìœ¼ë¡œ ëª…ì„¸í™”ë¥¼ í•œë‹¤ë“ ì§€ í•˜ëŠ” ì‹ì˜ í¸ì§‘ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì´ìƒì„ ìœ„í•´ ì‹¤í–‰ í´ë˜ìŠ¤ì™€ ë™ì¼í•œ ìˆ˜ì¤€ì—ì„œ OpenApiConfig í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³  info() ë©”ì„œë“œ
ë¥¼ ì ìš©í•˜ì—¬ API ëª…ì„¸ì„œ html ë¬¸ì„œë¥¼ ìƒì„±í•´ë´¤ìŠµë‹ˆë‹¤.

20250516 ìˆ˜ì—…ì—ì„œëŠ” Spring Security í•  ì˜ˆì •

# ë°±ì—”ë“œ ë³´í˜¸
- ì¤‘ìš” ë°ì´í„°ë¥¼ ë³´í˜¸í•˜ê³ , ê·œì •ì„ ì¤€ìˆ˜í•˜ë©°, ë¬´ë‹¨ ì ‘ì†ì„ ë°©ì§€í•˜ëŠ” ëª¨ë“  ê³¼ì •ìœ¼ë¡œ ë°±ì—”ë“œì—ì„œëŠ”
ì‚¬ìš©ì ì¸ì¦(Authentication) ë° ê¶Œí•œ ë¶€ì—¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ì²˜ë¦¬í•¨. ê¶Œí•œì´ ë¶€ì—¬ëœ ì‚¬ìš©ìë§Œ
ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ì†í•˜ê³  íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ.

- Spring Securityì˜ ì´í•´
- JWT(JSON Web Token)ìœ¼ë¡œ ë°±ì—”ë“œ ë³´í˜¸
- ì—­í•  ê¸°ë°˜ ë³´ì•ˆ
- ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ OAuth2(ì¹´ì¹´ì˜¤í†¡/êµ¬ê¸€/ê¹ƒí—ˆë¸Œë¥¼ ì´ìš©í•œ 3rd party ë¡œê·¸ì¸) ê°œë…

## Spring Securityì˜ ì´í•´

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ì´í•˜ì˜ ê¸°ëŠ¥ì„ í™œì„±í™” ì‹œí‚µë‹ˆë‹¤.
- ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ì í•˜ë‚˜ë¥¼ í¬í•¨í•˜ëŠ” AuthenticationManager ë¹ˆ(bean), ì‚¬ìš©ì ì´ë¦„ì€ user,
ì•”í˜¸ëŠ” ì½˜ì†”ì— ì¶œë ¥ë¨.
- /css ë° /images ê°™ì€ ì¼ë°˜ì ì¸ ì •ì  ë¦¬ì†ŒìŠ¤ ìœ„ì¹˜ì˜ ê²½ë¡œë¥¼ ë¬´ì‹œí•˜ê³ , ë‹¤ë¥¸ ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì—
ëŒ€í•œ HTTP(HyperText Transfer Protocol) ê¸°ë³¸ ì¸ì¦
- ìŠ¤í”„ë§ì˜ ApplicationEventPublisher ì¸í„°í˜ì´ìŠ¤ë¡œ ê²Œì‹œë˜ëŠ” ë³´í˜¸ ì´ë²¤íŠ¸
- HSTS(HTTP Strict Transport Security), XSS(Cross-Site Scripting), 
  CSRF(Cross-Site Request Forgery)ë¥¼ ë¹„ë¡¯í•œ ì¼ë°˜ì ì¸ ì €ìˆ˜ì¤€ ê¸°ëŠ¥ì„ í™œì„±í™”
- ìë™ ìƒì„±ë˜ëŠ” ê¸°ë³¸ ë¡œê·¸ì¸ í˜ì´ì§€

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” build.gradleì—
```properties
implementation 'org.springframework.boot:spring-boot-starter-security:3.4.5'
```
ë¥¼ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.
ë²„ì „ì„ ëª…ì‹œí•˜ê³  ì‹¶ë‹¤ë©´
chrome -> mvn -> spring security starter ê²€ìƒ‰(ì•ˆí•˜ë©´ core, web ë“±ì´ ëœ¹ë‹ˆë‹¤)
ë²„ì „ ì²´í¬ -> groovy shortë¡œ ê°€ì ¸ì˜¤ì‹œë©´ ë©ë‹ˆë‹¤.
ì½”ë¼ë¦¬ ëˆŒëŸ¬ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.

ì´í›„ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰ì‹œí‚¤ê³ 
http://localhost:8080 ìœ¼ë¡œ ì ‘ì†í•˜ê²Œ ë˜ë©´ ì•Œì•„ì„œ ì—”ë“œí¬ì¸íŠ¸ /loginì´ ì¶”ê°€ë˜ë©´ì„œ
ê¸°ë³¸ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë„˜ì–´ê°€ê²Œ ë©ë‹ˆë‹¤.

ê±°ê¸°ì„œ usernameì— user
passordì— ì½˜ì†”ì— ì°íŒ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ìœ¼ë©´ /apië¥¼ í†µí•œ JSON ë¬¸ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´í›„ ì €í¬ëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì‘ë™ ë°©ì‹ì„ êµ¬ì„±(Configuration)í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
ë³´ì•ˆ êµ¬ì„± íŒŒì¼ì„ ì´ìš©í•˜ì—¬ íŠ¹ì • ì—­í• ì´ë‚˜ ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” URL ë˜ëŠ” URL íŒ¨í„´ì„ ì •ì˜í•  ìˆ˜ ìˆê³ ,
ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜, ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤, ì„¸ì…˜ ê´€ë¦¬ ë“±ë„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤í–‰ í´ë˜ìŠ¤ì™€ ë™ì¼í•œ ìˆ˜ì¤€ì— SecurityConfig í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.

```java
package com.packt.cardatabase;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;

@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public InMemoryUserDetailsManager userDetailsService() {
        UserDetails user = User.builder()
                .username("user")
                .password(passwordEncoder().encode("password"))
                .roles("USER")
                .build();

        return new InMemoryUserDetailsManager(user);
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

ì´ìƒì˜ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ ,
@Configurationê³¼ @EnableWebSecurity ì• ë„ˆí…Œì´ì…˜ì€ ê¸°ë³¸ ì›¹ ë³´í˜¸ configë¥¼ í•´ì œí•˜ë©°,
ì´ í´ë˜ìŠ¤ì—ì„œ êµ¬ì„±ì„ ì •ì˜í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
ì¶”í›„ í•™ìŠµí•˜ê²Œ ë  filterChain(HttpSecurity http) ë©”ì„œë“œ ë‚´ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜
ì–´ë–¤ ì—”ë“œí¬ì¸íŠ¸ê°€ ë³´í˜¸ë˜ê³  ìˆëŠ”ì§€, ì–´ë–¤ ì—”ë“œí¬ì¸íŠ¸ê°€ ë³´í˜¸ë˜ê³  ìˆì§€ ì•Šì€ì§€ ì •ì˜ ê°€ëŠ¥í•©ë‹ˆë‹¤.
ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ê°€ ë³´í˜¸ë˜ë„ë¡ ì„¤ì •ëœ ê¸°ë³¸ ì„¤ì •ì„ ì´ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í˜„ì¬ëŠ” ì•ˆì”ë‹ˆë‹¤(ì¶”í›„ êµ¬í˜„ ì˜ˆì •).

ê·¸ë¦¬ê³  ì‘ì„±í•œ ë¶€ë¶„ì—ì„œ UserDetailsServiceë¥¼ êµ¬í˜„í•˜ëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ InMemoryDetailsManager
ë¥¼ ì´ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ì‚¬ìš©ì/ì•”í˜¸ ì¸ì¦ êµ¬í˜„ì„ í•  ìˆ˜ ìˆëŠ”ë°,
PasswordEncoderë¥¼ ì´ìš©í•˜ë©´ bcrypt ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì•”í˜¸ë¥¼ ì¸ì½”ë”©í•  ìˆ˜ ìˆë‹¤(ì¦‰
ì•”í˜¸ê°€ ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì–´ë–¤ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë°”ê¿”ë²„ë¦¬ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤).

ìš°ë¦¬ëŠ” ì´ìƒì—ì„œ username user / password passwordì¸ ì—­í•  USERì˜ ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ìë¥¼ ìƒì„±í•œê²ë‹ˆë‹¤

- ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ìë¥¼ ì´ìš©í•˜ì—¬ ì¸ì¦ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ìë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì€ ê°œë°œë‹¨ê³„ì—ì„œëŠ” ê´œì°®ì§€ë§Œ ì¼ë°˜ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì‚¬ìš©ìë¥¼
    DBì— ì €ì¥í•©ë‹ˆë‹¤.

ì‚¬ìš©ìë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ë ¤ë©´ ì‚¬ìš©ì ì—”í‹°í‹° í´ë˜ìŠ¤ ë° ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•´ì•¼í•©ë‹ˆë‹¤(Car/Ownerì²˜ëŸ¼)
ì•”í˜¸ëŠ” ì¼ë°˜ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ DBì— ì €ì¥ë˜ë©´ ì•ˆë˜ê² ì£ . ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ê°€ í¬í•¨ëœ ë°ì´í„°ë² ì´ìŠ¤ê°€ í•´í‚¹ë˜ë©´
ê³µê²©ìëŠ” ì•”í˜¸ë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì§ì ‘ íšë“ì´ ê°€ëŠ¥í•˜ê²Œ ë˜ê² ë„¤ìš”.
ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ì•”í˜¸ í•´ì‹±ì— ì´ìš©í•  ìˆ˜ ìˆëŠ” bcryptì™€ ê°™ì€ ì—¬ëŸ¬ í•´ì‹± ì•Œê³ ë¦¬ì¦˜ì„ ì œê³µí•©ë‹ˆë‹¤.
ì´ì œ ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ê³¼ì •ì„ ìˆ˜ì—…í•  ì˜ˆì •ì…ë‹ˆë‹¤.

### ê³¼ì •
1. domain íŒ¨í‚¤ì§€ ë‚´ì— AppUserë¼ëŠ” ìƒˆ í´ë˜ìŠ¤ë¥¼ ìƒì„±í• ê²ë‹ˆë‹¤.
2. AppUser í´ë˜ìŠ¤ì— @Entity ì• ë„ˆí…Œì´ì…˜ ì ìš©, í•„ë“œë¡œ id / username / password / role
    ëª¨ë“  í•„ë“œì— nullable = false ì ìš©í–ˆìŠµë‹ˆë‹¤ / uniqueëŠ” ìƒí™©ì— ë”°ë¼ ì„ íƒí•´ì•¼í•˜ëŠ”ë°,
    ì—¬ëŸ¬ë¶„ì´ í™•ì‹¤í•œ ê·¼ê±°í•˜ì— ì„¤ì •í•˜ì…”ì•¼í•©ë‹ˆë‹¤.
```java
package com.packt.cardatabase.domain;

import jakarta.persistence.*;

@Entity
public class AppUser {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    @Column(nullable = false, unique = true)
    private Long id;

    @Column(nullable = false, unique = true)
    private String username;

    @Column(nullable = false, unique = false)
    private String password;

    @Column(nullable = false)
    private String role;            // ì €í¬ëŠ” SecurityConfigì—ì„œ "USER"ë¼ê³  ì¼ìŠµë‹ˆë‹¤.

    // ìƒì„±ì, Getter / Setter
}

```
3. AppUserRepository ì¸í„°í˜ì´ìŠ¤ ìƒì„±.
```java
package com.packt.cardatabase.domain;

import org.springframework.data.repository.CrudRepository;

import java.util.Optional;

public interface AppUserRepository extends CrudRepository<AppUser, Long> {
    Optional<AppUser> findByUsername(String username);
}
```
ì´ìƒì˜ ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ ê·¸ëƒ¥ ìˆëŠ” ê²ƒë§Œ ì“°ëŠ”ê²Œ ì•„ë‹ˆë¼ ì‚¬ì „ì— findByUsername()
ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ë†¨ìŠµë‹ˆë‹¤. ì´ ë©”ì„œë“œëŠ” ì¸ì¦ í”„ë¡œì„¸ìŠ¤ ì¤‘ DBì—ì„œ ì‚¬ìš©ìë¥¼ ì°¾ëŠ” ë° ì´ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤.
ê·¸ë¦¬ê³  null ì˜ˆì™¸ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ Optionalì„ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

4. ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ì„œ ì•„ê¹Œ ì‚¬ìš©í–ˆë˜ UserDetailsService ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©ì ì¸ì¦(Authentication) ë° ì¸ê°€(Authorization)ì— ì´ìš©í•©ë‹ˆë‹¤.
    ë£¨íŠ¸ íŒ¨í‚¤ì§€ì—ì„œ service íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í• ê²ë‹ˆë‹¤.

5. service íŒ¨í‚¤ì§€ì— UserDetailsServiceImpl í´ë˜ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- ì½”ë“œ ê¸¸ì–´ì„œ ì•ˆ ë¶™ì—¬ë„£ìœ¼ë‹ˆê¹Œ ê¼­ í™•ì¸í•˜ì„¸ìš”.

ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì¸ì¦ ì²˜ë¦¬ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œ
UserDetailsServiceImpl í´ë˜ìŠ¤ì— AppUserRepositoryë¥¼ fieldë¡œ ì£¼ì…í•´ì•¼í•©ë‹ˆë‹¤.
ê·¸ë¦¬ê³  Implì´ ë¶™ì€ í´ë˜ìŠ¤ëŠ” ì–´ë–¤ ì˜ë¯¸ì˜€ëŠ”ì§€ë„ ì´í•´í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  AppUserRepositoryì—ì„œ findByUsername ë©”ì„œë“œë¥¼ ì •ì˜í–ˆëŠ”ë°,
ì´ ë©”ì„œë“œëŠ” Optionalì„ ë°˜í™˜í•˜ë¯€ë¡œ isPresent() ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì—¬ í•´ë‹¹ usernameì„
ì§€ë‹Œ AppUser ê°ì²´ê°€ ì¡´ì¬í•˜ëŠ”ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ UsernameNotFoundException ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
loadUserByUsername ë©”ì„œë“œëŠ”(implement ë°›ì€ê²ë‹ˆë‹¤) ë©”ì„œë“œ ì¸ì¦ì— í•„ìš”í•œ
UserDetails ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ì¸ì¦ì— í•„ìš”í•œ ì‚¬ìš©ìë¥¼ ë§Œë“¤ê¸° ìœ„í•˜ì—¬
ìŠ¤í”„ë§ ì‹œíë¦¬í‹° UserBuilder í´ë˜ìŠ¤ë¥¼ ì´ìš©í•©ë‹ˆë‹¤(ì½”ë“œ í™•ì¸ í•„ìš”).

ì´ìƒì—ì„œ ì½”ë“œ ì‘ì„±í•œ ë‚´ìš©ì€ ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ìê°€ ì•„ë‹ˆë¼ DBì— ì €ì¥ëœ ì‚¬ìš©ìë¥¼ ë§Œë“œëŠ”
ë°©ì‹ì´ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(AppUser ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ HediSQLì—ì„œ ë³¼ ìˆ˜ ìˆì„ê±°ê³ ,
ê·¸ë ‡ë‹¤ë©´ ì˜ˆì œ ë°ì´í„°ë¥¼ mainì—ì„œ ì§‘ì–´ë„£ì„ ìˆ˜ë„ ìˆê² ë„¤ìš”).
ê·¸ë ‡ë‹¤ë©´ ìš°ë¦¬ëŠ” ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ìë¥¼ ë¹„í™œì„±í™”ì‹œí‚¤ê³  DBì— ì €ì¥í•  ìˆ˜ ìˆê²Œë˜ê² ìŠµë‹ˆë‹¤.

ë‹¤ìŒ ê³¼ì •ì—ì„œ ìš°ë¦¬ëŠ” ì˜ˆì œ user ê°ì²´ë¥¼ ì‚½ì…í•´ë³¼ ì˜ˆì •ì…ë‹ˆë‹¤.

SecurityConfig í´ë˜ìŠ¤ì—ì„œ ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ì ëŒ€ì‹  ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ìë¥¼ ì´ìš©í•˜ë„ë¡ ì§€ì •
í•´ì•¼í•©ë‹ˆë‹¤(ì•„ê¹Œ ë³´ì—¬ë“œë ¸ë“¯ì´ ì´ì œ ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ìëŠ” ì‚¬ìš© ë¶ˆê°€ê°€ ëìŠµë‹ˆë‹¤).

SecurityConfig í´ë˜ìŠ¤ì—ì„œ userDetailsService() ë©”ì„œë“œë¥¼ ì‚­ì œ(ì €í¬ëŠ” ì£¼ì„ì²˜ë¦¬í•˜ê² ìŠµë‹ˆë‹¤)í•˜ê³ 
ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ìë¥¼ ì´ìš©í•˜ë„ë¡ ìƒˆë¡œìš´ configureGlobal ë©”ì„œë“œë¥¼ ì¶”ê°€í• ê²ë‹ˆë‹¤.

ì•”í˜¸ë¥¼ DBì— ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì €ì¥í•´ì„œëŠ” ì•ˆ ë˜ê¸° ë•Œë¬¸ì— configureGlobal ë©”ì„œë“œì—ì„œ ì•”í˜¸ í•´ì‹± ì•Œê³ ë¦¬ì¦˜ì„
ì •ì˜í• ê²ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì•„ê¹Œì²˜ëŸ¼ bcrypt ì•Œê³ ë¦¬ì¦˜ì„ ì´ìš©í• ê²ë‹ˆë‹¤. ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ BCryptPasswordEncoder
í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ ì¸ì¦ í”„ë¡œì„¸ìŠ¤ ì¤‘ì— í•´ì‹±ëœ ì•”í˜¸ë¥¼ bcryptë¡œ ì‰½ê²Œ ì¸ì½”ë”©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
package com.packt.cardatabase;

import com.packt.cardatabase.service.UserDetailsServiceImpl;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;

@Configuration
@EnableWebSecurity
public class SecurityConfig {
    private final UserDetailsServiceImpl userDetailsService;

    public SecurityConfig(UserDetailsServiceImpl userDetailsService) {
        this.userDetailsService = userDetailsService;
    }

    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(new BCryptPasswordEncoder());
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}

```
ì•”í˜¸ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê¸° ì „ì— bcryptë¥¼ í†µí•´ í•´ì‹±í• ê²ë‹ˆë‹¤.

6. ëìœ¼ë¡œ ì°¨/ì†Œìœ ì£¼ ì˜ˆì œ ë°ì´í„°ë¥¼ ë„£ì—ˆë˜ ê²ƒì²˜ëŸ¼ CommandLineRunner ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬
ì˜ˆì œ ì‚¬ìš©ìë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.





