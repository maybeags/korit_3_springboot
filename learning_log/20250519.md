# ì…ì‹¤ ì²´í¬ í•´ì£¼ì„¸ìš” !! ğŸš‘

# ë‹¤ë¥¸ ìš”ì²­ ë³´í˜¸í•˜ê¸°

20250516ì—ëŠ” ë¡œê·¸ì¸ ë‹¨ê³„ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ì´ì œ ë‚˜ë¨¸ì§€ ìˆ˜ì‹  ìš”ì²­ì— ëŒ€í•œ ì¸ì¦ ì²˜ë¦¬
ì‘ì—…ì„ í•©ë‹ˆë‹¤. ì¸ì¦ í”„ë¡œì„¸ìŠ¤ì—ëŠ” ìš”ì²­ì´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì „ë‹¬ë˜ê¸° ì „ì´ë‚˜
í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µì´ ì „ì†¡ë˜ê¸° ì „ì— ì¼ë¶€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” _í•„í„°_ ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

1. í•„í„° í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ëª¨ë“  ë‹¤ë¥¸ ìˆ˜ì‹  ìš”ì²­ì„ ì¸ì¦ì²˜ë¦¬í• ê²ë‹ˆë‹¤. ë£¨íŠ¸ íŒ¨í‚¤ì§€ì—
    AuthenticationFilter í´ë˜ìŠ¤ë¥¼ ìƒì„±. í´ë˜ìŠ¤ëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜
    OncePerRequestFilter ì¸í„°í˜ì´ìŠ¤ë¥¼ _í™•ì¥_ (extends) í•˜ì—¬ ì¸ì¦ì„ êµ¬í˜„í•˜ëŠ”
    doFilterInternal ë©”ì„œë“œë¥¼ ì œê³µ. ìš”ì²­ì—ì„œ í† í°ì„ í™•ì¸í•˜ê¸° ìœ„í•´ í•„í„°
    í´ë˜ìŠ¤ì—ì„œ JwtService ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì£¼ì…í•´ì•¼ í•©ë‹ˆë‹¤. SecurityContextHolderë¥¼
    í†µí•˜ì—¬ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ì¸ì¦ëœ ì‚¬ìš©ìì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ì €ì¥í• ê²ë‹ˆë‹¤.

    ì½”ë“œë¥¼ í†µí•´ì„œ ì´ìƒì˜ ë©”ì„œë“œ ë° í´ë˜ìŠ¤ë“¤ì„ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.

```java
package com.packt.cardatabase;

import com.packt.cardatabase.service.JwtService;
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.http.HttpHeaders;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;
import java.util.Collections;

@Component
public class AuthenticationFilter extends OncePerRequestFilter {
    private final JwtService jwtService;

    public AuthenticationFilter(JwtService jwtService) {
        this.jwtService = jwtService;
    }


    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response,
                                    FilterChain filterChain)
            throws ServletException, IOException {
        // í† í° ê²€ì¦ ë° ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ê¸° # 1
        String jws = request.getHeader(HttpHeaders.AUTHORIZATION);
        if(jws != null) {
            // í† í° ê²€ì¦ ë° ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ê¸° # 2
            String user = jwtService.getAuthUser(request);
            // ì¸ì¦í•˜ê¸°
            Authentication authentication =
                    new UsernamePasswordAuthenticationToken(user, null,
                            Collections.emptyList());

            SecurityContextHolder.getContext().setAuthentication(authentication);
        }

        filterChain.doFilter(request, response);
    }
}
```

2. ìŠ¤í”„ë§ ì‹œíë¦¬í‹° config ê´€ë ¨ í•„í„° í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. SecurityConfig í´ë˜ìŠ¤ì—
ì•„ê¹Œ ë§Œë“  AuthenticationFilter í´ë˜ìŠ¤ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.
```java
public class SecurityConfig {
    private final UserDetailsServiceImpl userDetailsService;
    //ì¶”ê°€ëœ ë¶€ë¶„
    private final AuthenticationFilter authenticationFilter;

    public SecurityConfig(UserDetailsServiceImpl userDetailsService, AuthenticationFilter authenticationFilter) {
        this.userDetailsService = userDetailsService;
        this.authenticationFilter = authenticationFilter;   // ì¶”ê°€ëœ ë¶€ë¶„
    }
}
```